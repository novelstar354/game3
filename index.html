<!doctype html>
<html lang="ja">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1" />
   <link rel="icon" href="https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcQoZ5nF2nh3MGMh1FdK-P-WiE6f-TJUeZJDI1QVThw-Ew&s=10" sizes="16×16" type="image/png" />  
<title>シューティング</title>
<style>
     footer {
           padding: 30px;
           text-align: center;
           font-size: 0.85rem;
           color: rgba(255,255,255,0.5);
           border-top: 1px solid rgba(255,255,255,0.1);
           margin-top: 60px;
     }
  :root{ --bg:#0b1220; --accent:#39f; }
  html,body{margin:0;height:100%;background:#071021;color:#eef;font-family:sans-serif;}
  .wrap{max-width:900px;margin:auto;padding:10px;}
  canvas{width:100%;height:60vh;max-height:700px;background:#020c18;border-radius:8px;display:block;}
  header{display:flex;justify-content:space-between;align-items:center;flex-wrap:wrap;gap:10px;}
  button{background:var(--accent);color:white;border:none;padding:8px 12px;border-radius:6px;font-size:14px;cursor:pointer;}
  .hud{display:flex;justify-content:space-between;margin-top:6px;font-size:14px;}
  .touch-controls{display:flex;justify-content:center;gap:20px;margin-top:8px;}
  .touch-btn{background:#ffffff22;color:white;padding:14px 18px;font-size:20px;border-radius:10px;user-select:none;}
  .touch-btn:active{background:#ffffff55;}
  @media (min-width:768px){ .touch-controls{display:none;} }
</style>
</head>
<body>
<div class="wrap">
<header>
  <h2>シューティング</h2>
  <div>
    <button id="startBtn">開始</button>
    <button id="restartBtn">リスタート</button>
  </div>
</header>
<canvas id="game"></canvas>
<div class="hud">
  <div>スコア: <span id="score">0</span></div>
  <div>ライフ: <span id="life">3</span></div>
  <div>レベル: <span id="level">1</span></div>
</div>
<div class="touch-controls">
  <div class="touch-btn" id="leftBtn">◀</div>
  <div class="touch-btn" id="fireBtn">●</div>
  <div class="touch-btn" id="rightBtn">▶</div>
</div>
</div>
     <footer>
       © 2025 STAR CORPORATION - All Rights Reserved.
     </footer>
  
<script>
(() =>{
  const canvas=document.getElementById('game');
  const ctx=canvas.getContext('2d');

  function fit(){
    const r=window.devicePixelRatio||1;
    const rect=canvas.getBoundingClientRect();
    canvas.width=rect.width*r;
    canvas.height=rect.height*r;
    ctx.setTransform(r,0,0,r,0,0);
  }
  window.addEventListener('resize',fit);
  fit();

  let running=false;
  let paused=false;
  let last=0;
  let score=0,life=3,level=1;
  const bullets=[],enemies=[],enemyBullets=[];

  const player={x:150,y:0,w:40,h:28,speed:260,cooldown:0};

  const keys={left:false,right:false,fire:false};

  function reset(){
    score=0;life=3;level=1;
    bullets.length=0;enemies.length=0;enemyBullets.length=0;
    player.x=canvas.width/(window.devicePixelRatio||1)/2-player.w/2;
    player.y=canvas.height/(window.devicePixelRatio||1)-70;
  }
  reset();

  function spawn(){
    const w=30+Math.random()*25;
    const type=Math.random()<0.5?"normal":"fast";
    const hp= type=="normal" ? 1+Math.floor(level/2) : 1;
    const sp= type=="normal" ? 60+level*20 : 120+level*30;
    const x=Math.random()*(canvas.width/(window.devicePixelRatio||1)-w-10)+5;
    enemies.push({x,y:-40,w,h:w*0.7,speed:sp,hp,type,fireCd:1+Math.random()*1.5});
  }

  function spawnBoss(){
    enemies.push({x:60,y:-200,w:200,h:120,speed:40,hp:80+level*50,type:"boss",fireCd:0.8});
  }

  function coll(a,b){return !(a.x+a.w<b.x||a.x>b.x+b.w||a.y+a.h<b.y||a.y>b.y+b.h);}  

  function update(dt){
    if(paused)return;

    if(keys.left)player.x-=player.speed*dt;
    if(keys.right)player.x+=player.speed*dt;
    const max=canvas.width/(window.devicePixelRatio||1)-player.w;
    if(player.x<0)player.x=0;
    if(player.x>max)player.x=max;

    if(player.cooldown>0)player.cooldown-=dt;
    if(keys.fire&&player.cooldown<=0){
      bullets.push({x:player.x+player.w/2-3,y:player.y-12,w:6,h:12,speed:480});
      player.cooldown=0.25;
    }

    bullets.forEach((b,i)=>{b.y-=b.speed*dt;if(b.y<-20)bullets.splice(i,1);});

    if(Math.random()<0.02*level)spawn();
    if(score>200 && !enemies.some(e=>e.type=="boss")) spawnBoss();

    enemies.forEach((e,i)=>{
      e.y+=e.speed*dt;

      // 敵の攻撃
      e.fireCd-=dt;
      if(e.fireCd<=0){
        enemyBullets.push({x:e.x+e.w/2-4,y:e.y+e.h,w:8,h:12,speed:250});
        e.fireCd=e.type=="boss"?0.3:1+Math.random();
      }

      if(coll(e,player)){
        enemies.splice(i,1);
        life--; if(life<=0)running=false;
      }

      bullets.forEach((b,j)=>{
        if(coll(b,e)){
          bullets.splice(j,1);
          e.hp--; if(e.hp<=0){enemies.splice(i,1);score+= e.type=="boss"?200:10;}
        }
      });
    });

    enemyBullets.forEach((b,i)=>{
      b.y+=b.speed*dt;
      if(b.y>canvas.height)enemyBullets.splice(i,1);
      if(coll(b,player)){
        enemyBullets.splice(i,1);
        life--; if(life<=0)running=false;
      }
    });

    level=1+Math.floor(score/100);
  }

  function draw(){
    const W=canvas.width/(window.devicePixelRatio||1);
    const H=canvas.height/(window.devicePixelRatio||1);
    ctx.clearRect(0,0,W,H);

    ctx.fillStyle="#9ef";
    ctx.fillRect(player.x,player.y,player.w,player.h);

    ctx.fillStyle="white";
    bullets.forEach(b=>ctx.fillRect(b.x,b.y,b.w,b.h));

    enemyBullets.forEach(b=>{ctx.fillStyle="#f55";ctx.fillRect(b.x,b.y,b.w,b.h);});

    enemies.forEach(e=>{
      ctx.fillStyle=e.type=="boss"?"#f0f":"#fb5";
      ctx.fillRect(e.x,e.y,e.w,e.h);
    });

    if(paused){
      ctx.fillStyle="rgba(0,0,0,0.5)";
      ctx.fillRect(0,0,W,H);
      ctx.fillStyle="#fff";
      ctx.font="32px sans-serif";
      ctx.fillText("PAUSED",W/2-60,H/2);
    }
  }

  function loop(t){
    const dt=(t-last)/1000; last=t;
    if(running)update(dt);
    draw();
    requestAnimationFrame(loop);
  }
  requestAnimationFrame(loop);

  // --- キーボード操作 ---
  window.addEventListener('keydown',e=>{
    if(e.key==='ArrowLeft')keys.left=true;
    if(e.key==='ArrowRight')keys.right=true;
    if(e.code==='Space')keys.fire=true;
    if(e.key==='Enter')running=true;
    if(e.key.toLowerCase()==='p')paused=!paused;
  });
  window.addEventListener('keyup',e=>{
    if(e.key==='ArrowLeft')keys.left=false;
    if(e.key==='ArrowRight')keys.right=false;
    if(e.code==='Space')keys.fire=false;
  });

  // --- スマホ操作 ---
  function bindTouch(id,down,up){
    const el=document.getElementById(id);
    el.addEventListener('touchstart',e=>{e.preventDefault();down();});
    el.addEventListener('touchend',e=>{e.preventDefault();up();});
  }
  bindTouch('leftBtn',()=>keys.left=true,()=>keys.left=false);
  bindTouch('rightBtn',()=>keys.right=true,()=>keys.right=false);
  bindTouch('fireBtn',()=>keys.fire=true,()=>keys.fire=false);

  // UI
  document.getElementById('startBtn').onclick=()=>running=true;
  document.getElementById('restartBtn').onclick=()=>{reset();running=true;};

})();
</script>
</body>
</html>
